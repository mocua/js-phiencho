!function(d,c,a,e){function b(i){var g=i;if(i instanceof Event){g=d(i.currentTarget)}if(!g.is(":visible")){return}var j=g[0].getBoundingClientRect(),h=j.bottom+100;g.children().each(function(){var l=d(this),k=this.getBoundingClientRect();if(k.bottom<j.top){return}if(k.top>h){return false}l.find("span.smilie--lazyLoad").each(function(){var n=d(this),m=this.getBoundingClientRect();if(m.top<=h){f(n)}})})}function f(i){var h=d("<img />").attr({"class":i.attr("class").replace(/(\s|^)smilie--lazyLoad(\s|$)/," "),alt:i.attr("data-alt"),title:i.attr("title"),src:i.attr("data-src"),"data-shortname":i.attr("data-shortname")});var g=function(){var j=function(){i.replaceWith(h)};if(c.requestAnimationFrame){c.requestAnimationFrame(j)}else{j()}};if(!h.prop("complete")){h.on("load",g)}else{g()}}XF.SiropuShoutbox=XF.Element.newHandler({options:{lastId:0,refreshInterval:0,refreshTimeout:600,loadMore:0,lastActive:0,reverse:false,collapsed:false,timeout:1000,sound:"on"},audio:"",init:function(){if(!this.options.collapsed){this.startRefreshInterval()}if(this.options.sound=="on"){this.loadAudio()}var h=this;var g=this.$target.find(".siropuShoutboxShouts");d(a).on("shoutbox:sound-on",function(){h.soundOn()});d(a).on("shoutbox:sound-off",function(){h.soundOff()});d(a).on("shoutbox:toggle-reverse",function(m,k){var l=h.options.loadMore;g.html("").parents(".siropuShoutbox").attr("data-reverse",k);h.options.reverse=k;h.options.loadMore=0;h.options.lastId=0;h.refresh(false);setTimeout(function(){h.options.loadMore=l},1000);var j=d(".siropuShoutbox .editorSmilies");if(j.length){j.remove()}});d(a).on("shoutbox:collapse",function(){h.stopRefreshInterval()});d(a).on("shoutbox:expand",function(){if(g.find("> li:not([data-id])").length){h.refresh(false)}h.startRefreshInterval()});d(a).on("shoutbox:submit",function(l){var j=d(this).find('input[name="shout"]');var k=j.val().trim();if(!k){return j.focus()}var m=XF.phrase("siropu_shoutbox_please_wait");if(h.options.timeout>1000){m=XF.phrase("siropu_shoutbox_please_wait_x_seconds")}j.val("").attr("placeholder",m).prop("disabled",true);h.stopRefreshInterval();XF.ajax("POST",XF.canonicalizeUrl("index.php?shoutbox/submit"),{last_id:h.options.lastId,shout:k},function(n){h.update(n);h.startRefreshInterval();h.options.lastActive=n.time;if(n.prune){g.find("li[data-id]").not(g.find('li[data-id="'+n.lastId+'"]')).remove()}},{global:false});setTimeout(function(){j.prop("disabled",false).attr("placeholder",XF.phrase("siropu_shoutbox_placeholder")).focus()},h.options.timeout)});this.$target.on("mouseover mouseout",".siropuShoutboxShouts > li",function(){d(this).find(".siropuShoutboxActions").toggle()});var i=false;g.on("scroll",function(){var n=d(this)[0].scrollHeight-d(this).innerHeight();var m=parseInt(d(this).scrollTop());d(this).attr("data-autoscroll",0);if(((m==n||m+1==n||m-1==n)&&h.options.reverse)||m==0&&!h.options.reverse){d(this).attr("data-autoscroll",1)}if(h.options.loadMore&&!i&&(!h.options.reverse&&(m==n||m+1==n||m-1==n)||h.options.reverse&&m==0)){i=true;if(h.options.reverse){var l=d(this).find("> li[data-id]:first")}else{var l=d(this).find("> li[data-id]:last")}var k=d('<div class="siropuShoutboxLoadingMoreShouts" />');k.html('<i class="fas fa-cog fa-spin"></i> '+XF.phrase("siropu_shoutbox_loading_more_shouts"));if(h.options.reverse){k.addClass("siropuShoutboxReverse").insertBefore(d(this))}else{k.insertAfter(d(this))}var j=d(this).parents().find(".siropuShoutboxLoadingMoreShouts");setTimeout(function(){j.fadeOut();j.remove()},1000);XF.ajax("POST",XF.canonicalizeUrl("index.php?shoutbox/load-more"),{last_id:l.data("id")},function(o){if(o.html&&o.html.content){XF.setupHtmlInsert(o.html,function(p,q,r){if(h.options.reverse){l.before(p).get(0).scrollIntoView({behavior:"smooth",block:"nearest",inline:"start"})}else{l.after(p)}})}else{h.options.loadMore=0}i=false})}});d(c).resize(function(){h.adjustContentHeight()});g.on("load",".bbImage",function(){h.doAutoScroll()});setTimeout(function(){h.adjustContentHeight()},500);h.autoScroll()},update:function(j,i){var h=this;var g=this.$target.find(".siropuShoutboxShouts");if(j.html&&j.html.content){XF.setupHtmlInsert(j.html,function(k,o,p){var m=false;var l=d.grep(k,function(q){if(d(q).find(".bbImage").length){m=true}return g.find('li[data-id="'+d(q).data("id")+'"]').length?false:true});var n=g.find("> li:not([data-id])");if(n.length){n.remove()}if(h.options.reverse){d(l).appendTo(g);d(l).show()}else{d(l).hide();d(l).prependTo(g);d(l).slideDown()}if(m){setTimeout(function(){h.autoScroll()},1000)}else{h.autoScroll()}if(i===undefined){h.playSound()}})}if(j.lastId){h.setLastId(j.lastId)}if(h.options.refreshTimeout&&j.time-h.options.lastActive>=h.options.refreshTimeout){h.stopRefreshInterval()}},refresh:function(h){var g=this;XF.ajax("GET",XF.canonicalizeUrl("index.php?shoutbox/refresh"),{last_id:g.options.lastId},function(i){g.update(i,h)},{skipDefault:true,skipDefaultSuccess:true,global:false})},startRefreshInterval:function(){if(this.options.refreshInterval){this.refreshSet=setInterval(d.proxy(this,"refresh"),this.options.refreshInterval)}},stopRefreshInterval:function(){clearInterval(this.refreshSet)},setLastId:function(h,g){this.options.lastId=h;if(this.$target){this.$target.attr("data-last-id",h)}},loadAudio:function(){this.audio=new Audio(XF.config.url.basePath+"styles/default/siropu/shoutbox/new.mp3")},soundOn:function(){this.$target.attr("data-sound","on");this.options.sound="on";if(!this.audio){this.loadAudio()}},soundOff:function(){this.$target.attr("data-sound","off");this.options.sound="off"},playSound:function(){if(this.options.sound=="on"){this.audio.play()}},adjustContentHeight:function(){var k=this.$target;var j=k.find(".siropuShoutboxShouts");var l=d(c).height();var g=k.height();var i=j.height();var h=l-g;if(d("#siropuShoutboxFullPage").length){j.css("height",(i+h)+"px")}},autoScroll:function(){var g=this.$target.find(".siropuShoutboxShouts");if(g.attr("data-autoscroll")==1){this.doAutoScroll(g)}},doAutoScroll:function(g){if(this.options.reverse){g.scrollTop(10000000)}else{g.scrollTop(0)}}});XF.SiropuShoutboxToggleSound=XF.Click.newHandler({eventNameSpace:"siropuShoutboxToggleSound",options:{},init:function(){},click:function(){var g=d('.siropuShoutbox a[data-xf-click="siropu-shoutbox-toggle-sound"] .fa--xf');if(g.hasClass("fa-volume-up")){d(a).trigger("shoutbox:sound-off");g.removeClass("fa-volume-up").addClass("fa-volume-off");XF.Cookie.set("siropuShoutboxNoSound",true)}else{d(a).trigger("shoutbox:sound-on");g.removeClass("fa-volume-off").addClass("fa-volume-up");XF.Cookie.remove("siropuShoutboxNoSound")}}});XF.SiropuShoutboxToggleDirection=XF.Click.newHandler({eventNameSpace:"SiropuShoutboxToggleDirection",options:{},init:function(){},click:function(){var h=d('.siropuShoutbox a[data-xf-click="siropu-shoutbox-toggle-direction"] .fa--xf');var i=d(".siropuShoutbox form");var g=d(".siropuShoutboxShouts");i.remove();if(h.hasClass("fa-arrow-down")){i.insertAfter(g);h.removeClass("fa-arrow-down").addClass("fa-arrow-up");XF.Cookie.set("siropuShoutboxReverse",1);d(a).trigger("shoutbox:toggle-reverse",true)}else{i.insertBefore(g);h.removeClass("fa-arrow-up").addClass("fa-arrow-down");XF.Cookie.set("siropuShoutboxReverse",0);d(a).trigger("shoutbox:toggle-reverse",false)}i.toggleClass("siropuShoutboxReverse");XF.activate(i)}});XF.SiropuShoutboxToggleVisibility=XF.Click.newHandler({eventNameSpace:"siropuShoutboxToggleVisibility",options:{},init:function(){},click:function(){var g=d('.siropuShoutbox a[data-xf-click="siropu-shoutbox-toggle-visibility"] .fa--xf');if(g.hasClass("fa-minus")){d(a).trigger("shoutbox:collapse");g.removeClass("fa-minus").addClass("fa-plus");XF.Cookie.set("siropuShoutboxCollapsed",true)}else{d(a).trigger("shoutbox:expand");g.removeClass("fa-plus").addClass("fa-minus");XF.Cookie.remove("siropuShoutboxCollapsed")}d(".siropuShoutbox .block-body").toggle()}});XF.SiropuShoutboxEdit=XF.Element.newHandler({options:{},init:function(){this.$target.on("ajax-submit:response",d.proxy(this,"ajaxResponse"))},ajaxResponse:function(h,g){d(".siropuShoutboxShouts > li[data-id="+g.shout_id+"]").find(".siropuShoutboxMessage").html(g.shout_message)}});XF.SiropuShoutboxDelete=XF.Element.newHandler({options:{},init:function(){this.$target.on("ajax-submit:response",d.proxy(this,"ajaxResponse"))},ajaxResponse:function(h,g){d(".siropuShoutboxShouts > li[data-id="+g.shout_id+"]").fadeOut()}});XF.SiropuShoutboxSubmit=XF.Element.newHandler({options:{},init:function(){this.$target.on("submit",function(g){g.preventDefault();d(a).trigger("shoutbox:submit")})}});XF.SiropuShoutboxSmilies=XF.Element.newHandler({options:{},init:function(){var g=this.$target.parents("form");this.$target.on("click",function(i){i.preventDefault();var h=g.find(".editorSmilies");if(h.length){h.toggleClass("is-active")}else{h=d('<div class="editorSmilies" />');XF.ajax("GET",XF.canonicalizeUrl("index.php?editor/smilies"),{},function(j){if(j.html){XF.setupHtmlInsert(j.html,function(k){d(h).on("click","img.smilie",function(m){var l=g.find("input");l.val(l.val()+d(this).attr("alt")).focus()});h.html(k).appendTo(g).addClass("is-active")})}})}})}});XF.SiropuShoutboxSmiliesEmoji=XF.Element.newHandler({options:{},$menu:null,init:function(){var h=this;var j=this.$target;var i=j.parents("form");var g=i.find('input[name="shout"]');this.$menu=j;j.on("menu:complete",function(){var k=d(this).find(".menu-scroller");k.onPassive("scroll",b);b(k);d(this).find(".js-emojiSearch").on("input",h.performSearch)});j.on("click",".js-emoji",function(){var k=d(this);if(d(this).find("img").length){k=d(this).find("img")}if(k.find("span").length){return}g.val(g.val()+(k.attr("alt")?k.attr("alt"):k.html())).focus();XF.logRecentEmojiUsage(k.data("shortname"))})},performSearch:function(){var j=d(this);var g=j.parents(".js-xfSmilieMenuBody").find(".js-emojiFullList");var h=j.parents(".js-xfSmilieMenuBody").find(".js-emojiSearchResults");var i;clearTimeout(i);i=setTimeout(function(){var l=j.val();if(!l||l.length<2){h.hide();g.show();b(g);return}var k=XF.canonicalizeUrl("index.php?editor/smilies-emoji/search");XF.ajax("GET",k,{q:l},function(m){if(!m.html){return}XF.setupHtmlInsert(m.html,function(n){g.hide();h.replaceWith(n)})})},300)}});XF.SiropuShoutboxPopup=XF.Click.newHandler({eventNameSpace:"siropuShoutboxPopup",init:function(){},click:function(g){g.preventDefault();var h;if(h===undefined||h.closed){h=c.open(this.$target.attr("href"),"siropuShoutboxPopup","width=800,height=500")}else{h.focus()}}});XF.SiropuShoutboxTag=XF.Click.newHandler({eventNameSpace:"siropuShoutboxTag",init:function(){},click:function(i){var g=this.$target.parents(".siropuShoutbox").find('input[name="shout"]');var h=g.val();g.val(h+" @"+this.$target.next("a").text()+(h?"":", ")).focus()}});XF.Element.register("siropu-shoutbox","XF.SiropuShoutbox");XF.Element.register("siropu-shoutbox-submit","XF.SiropuShoutboxSubmit");XF.Element.register("siropu-shoutbox-smilies","XF.SiropuShoutboxSmilies");XF.Element.register("siropu-shoutbox-smilies-emoji","XF.SiropuShoutboxSmiliesEmoji");XF.Element.register("siropu-shoutbox-edit-shout","XF.SiropuShoutboxEdit");XF.Element.register("siropu-shoutbox-delete-shout","XF.SiropuShoutboxDelete");XF.Click.register("siropu-shoutbox-popup","XF.SiropuShoutboxPopup");XF.Click.register("siropu-shoutbox-toggle-sound","XF.SiropuShoutboxToggleSound");XF.Click.register("siropu-shoutbox-toggle-direction","XF.SiropuShoutboxToggleDirection");XF.Click.register("siropu-shoutbox-toggle-visibility","XF.SiropuShoutboxToggleVisibility");XF.Click.register("siropu-shoutbox-user-tag","XF.SiropuShoutboxTag")}(jQuery,window,document);