!function(g,h,k,l){XF.CommentClick=XF.Click.newHandler({eventNameSpace:"XFCommentClick",options:{editorTarget:null,commentContainer:".js-commentContainer",href:null},$editorTarget:null,$commentForm:null,href:null,loading:!1,init:function(){var a=this.options.editorTarget;a?(this.$editorTarget=XF.findRelativeIf(a,this.$target),this.$editorTarget.length?(this.href=this.options.href||this.$target.attr("href"))||console.error("No comment URL specified."):console.error("No comment target found")):console.error("No comment editorTarget specified")},
click:function(a){this.$editorTarget&&this.href&&(a.preventDefault(),this.$editorTarget.parent().hasClass("is-commenting")&&g("form.message-quickReply").remove(),this.loading||(this.loading=!0,XF.ajax("GET",this.href,{},XF.proxy(this,"handleAjax"),{skipDefaultSuccessError:!0})))},handleAjax:function(a){var c=this.$editorTarget,d=this;a.errors||a.exception?this.loading=!1:XF.setupHtmlInsert(a.html,function(b,a){b.hide().insertAfter(c);XF.activate(b);d.$commentForm=b;b.on("ajax-submit:response",XF.proxy(d,
"commentSubmit"));b.find(".js-cancelButton").on("click",XF.proxy(d,"cancelClick"));b.find("input[type=hidden]").first().after('<input type="hidden" name="_xfInlineComment" value="1" />');c.parent().addClass("is-commenting");b.xfFadeDown(XF.config.speed.normal,function(){b.trigger("comment:shown");var a=b.find(d.options.commentContainer);a.length&&a.get(0).scrollIntoView(!0);d.loading=!1});b.trigger("comment:show")})},commentSubmit:function(a,c){if(!c.errors&&!c.exception){a.preventDefault();c.message&&
XF.flashMessage(c.message,3E3);var d=this.$editorTarget,b=this;XF.setupHtmlInsert(c.html,function(a,e,g){e=b.options.editorTarget;e=e.replace(/<|\|/g,"").replace(/#[a-zA-Z0-9_-]+\s*/,"");var f=a.find(e);f.hide();d.replaceWith(f);b.$editorTarget=f;XF.activate(f);b.stopCommenting(!1,function(){f.xfFadeDown();b.$commentForm.trigger("quickcomment:commentcomplete",c)})})}},cancelClick:function(a){this.stopCommenting(!0)},stopCommenting:function(a,c){var d=this.$editorTarget,b=this.$commentForm,g=this,
e=function(){d.parent().removeClass("is-commenting");a&&d.xfFadeDown();c&&c();b.remove();g.$commentForm=null};b?b.xfFadeUp(null,e):e()}});XF.Click.register("comment","XF.CommentClick")}(jQuery,window,document);